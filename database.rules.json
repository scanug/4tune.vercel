{
  "rules": {
    ".read": false,
    ".write": false,

    "users": {
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || root.child('users/'+auth.uid+'/role').val() == 'admin')",
        ".write": "auth != null && auth.uid == $uid",

        "credits": { 
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100000000" 
        },
        "name": { 
          ".validate": "newData.isString() && newData.val().length >= 1 && newData.val().length <= 32" 
        },
        "avatar": { 
          ".validate": "newData.isString() || newData.val() == null" 
        },
        "winsWeek": { 
          ".validate": "newData.isNumber() && newData.val() >= 0" 
        },
        "winsMonth": { 
          ".validate": "newData.isNumber() && newData.val() >= 0" 
        },
        "lastWinAt": { 
          ".validate": "newData.isNumber() || newData.val() == null" 
        },
        "createdAt": { 
          ".validate": "newData.isNumber()" 
        },

        "profile": {
          ".read": "auth != null && (auth.uid == $uid || root.child('users/'+auth.uid+'/role').val() == 'admin')",
          ".write": "auth != null && auth.uid == $uid",
          "name": { 
            ".validate": "newData.isString() && newData.val().length >= 1 && newData.val().length <= 32" 
          },
          "avatar": { 
            ".validate": "newData.isString() || newData.val() == null" 
          }
        },

        "wallet": {
          ".read": "auth != null && (auth.uid == $uid || root.child('users/'+auth.uid+'/role').val() == 'admin')",
          ".write": "auth != null && (auth.uid == $uid || auth.token.admin == true)",
          "credits": { 
            ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100000000" 
          },
          "bonusCredits": { 
            ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100000000" 
          },
          "totalPurchasedEur": { 
            ".validate": "newData.isNumber() && newData.val() >= 0" 
          }
        },

        "lastSpin": {
          ".read": "auth != null && (auth.uid == $uid || root.child('users/'+auth.uid+'/role').val() == 'admin')",
          ".write": "auth != null && auth.uid == $uid",
          ".validate": "newData.isNumber() && (!data.exists() || newData.val() - data.val() >= 86400000)"
        },

        "missions": {
          ".read": "auth != null && (auth.uid == $uid || root.child('users/'+auth.uid+'/role').val() == 'admin')",
          ".write": "auth != null && auth.uid == $uid",
          "$missionKey": {
            ".validate": "newData.hasChildren(['progress','goal','reward','completed']) && newData.child('progress').isNumber() && newData.child('goal').isNumber() && newData.child('reward').isNumber() && newData.child('progress').val() >= 0 && newData.child('goal').val() >= 0 && newData.child('reward').val() >= 0 && newData.child('completed').isBoolean()"
          }
        },

        "role": { 
          ".read": "auth != null && root.child('users/'+auth.uid+'/role').val() == 'admin'", 
          ".write": "auth != null && auth.token.admin == true" 
        }
      }
    },

    "rooms": {
      "$roomCode": {
        ".read": "auth != null",
        
        ".write": "(auth != null && !data.exists() && newData.child('hostId').val() == auth.uid) || (data.exists() && root.child('rooms/'+$roomCode+'/hostId').val() == auth.uid)",

        "hostId": {
          ".write": "!data.exists()",
          ".validate": "newData.isString()"
        },

        "status": {
          ".validate": "newData.isString() && (newData.val() == 'waiting' || newData.val() == 'playing' || newData.val() == 'finished')"
        },

        "round": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
        },

        "currentRange": {
          ".validate": "newData.hasChildren(['min','max']) && newData.child('min').isNumber() && newData.child('max').isNumber() && newData.child('min').val() < newData.child('max').val()"
        },

        "startedAt": {
          ".validate": "newData.isNumber()"
        },

        "phase": {
          ".validate": "newData.isString() && (newData.val() == 'lobby' || newData.val() == 'betting' || newData.val() == 'reveal' || newData.val() == 'finished')"
        },

        "betEndTime": {
          ".validate": "newData.isNumber()"
        },

        "maxRounds": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 50"
        },

        "betTimeSeconds": {
          ".validate": "newData.isNumber() && newData.val() >= 5 && newData.val() <= 120"
        },

        "winningNumber": {
          ".validate": "newData.isNumber()"
        },

        "winningNumbers": {
          ".validate": "newData.val() != null"
        },

        "roundResults": {
          ".validate": "newData.val() != null"
        },

        "resultsHistory": {
          ".validate": "newData.val() != null"
        },

        "allWinsBonus": {
          ".validate": "newData.val() != null"
        },

        "sideBetResults": {
          ".validate": "newData.val() != null"
        },

        "payoutApplied": {
          "$playerId": {
            ".read": "auth != null && auth.uid == $playerId",
            ".write": "auth != null && auth.uid == $playerId && !data.exists()",
            ".validate": "newData.val() === true"
          }
        },

        "players": {
          ".read": "auth != null",
          "$playerId": {
            ".write": "auth != null && (auth.uid == $playerId || root.child('rooms/'+$roomCode+'/hostId').val() == auth.uid)",
            ".validate": "newData.hasChildren(['name']) && newData.child('name').isString()"
          }
        },

        "bets": {
          "$playerId": {
            ".write": "auth != null && auth.uid == $playerId",
            ".validate": "newData.hasChildren(['number','amount']) && newData.child('number').isNumber() && newData.child('amount').isNumber() && newData.child('amount').val() >= 1 && newData.child('amount').val() <= 50000"
          }
        },

        "sideBets": {
          "$playerId": {
            ".write": "auth != null && auth.uid == $playerId",
            ".validate": "newData.val() == null || ((!newData.child('evenHalf').exists() || (newData.child('evenHalf').isNumber() && newData.child('evenHalf').val() >= 0 && newData.child('evenHalf').val() <= 50000)) && (!newData.child('oddHalf').exists() || (newData.child('oddHalf').isNumber() && newData.child('oddHalf').val() >= 0 && newData.child('oddHalf').val() <= 50000)) && (!newData.child('twoPrimes').exists() || (newData.child('twoPrimes').isNumber() && newData.child('twoPrimes').val() >= 0 && newData.child('twoPrimes').val() <= 50000)) && (!newData.child('twoMultiplesOf10').exists() || (newData.child('twoMultiplesOf10').isNumber() && newData.child('twoMultiplesOf10').val() >= 0 && newData.child('twoMultiplesOf10').val() <= 50000)))"
          }
        }
      }
    },

    "rooms_music": {
      "$roomCode": {
        ".read": "auth != null",
        
        ".write": "(auth != null && !data.exists() && newData.child('hostId').val() == auth.uid) || (data.exists() && root.child('rooms_music/'+$roomCode+'/hostId').val() == auth.uid)",

        "hostId": {
          ".write": "!data.exists()",
          ".validate": "newData.isString()"
        },

        "createdAt": {
          ".validate": "newData.isNumber()"
        },

        "status": {
          ".validate": "newData.isString() && (newData.val() == 'lobby' || newData.val() == 'playing' || newData.val() == 'finished')"
        },

        "roundIndex": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
        },

        "maxRounds": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 50"
        },

        "roundMs": {
          ".validate": "newData.isNumber() && newData.val() >= 10000 && newData.val() <= 60000"
        },

        "prepMs": {
          ".validate": "newData.isNumber() && newData.val() >= 3000 && newData.val() <= 15000"
        },

        "startAt": {
          ".validate": "newData.isNumber()"
        },

        "playlist": {
          ".validate": "newData.hasChildren(['id','title'])"
        },

        "scoreboard": {
          ".validate": "newData.val() != null"
        },

        "wagers": {
          "$playerId": {
            ".write": "auth != null && auth.uid == $playerId && !data.exists()",
            ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 50000"
          }
        },

        "payoutApplied": {
          "$playerId": {
            ".read": "auth != null && auth.uid == $playerId",
            ".write": "auth != null && auth.uid == $playerId && !data.exists()",
            ".validate": "newData.val() === true"
          }
        },

        "players": {
          ".read": "auth != null",
          "$playerId": {
            ".write": "auth != null && (auth.uid == $playerId || root.child('rooms_music/'+$roomCode+'/hostId').val() == auth.uid)",
            ".validate": "newData.hasChildren(['name']) && newData.child('name').isString()"
          }
        },

        "current": {
          ".validate": "newData.val() != null",

          "answers": {
            "$playerId": {
              ".write": "auth != null && auth.uid == $playerId",
              ".validate": "newData.hasChildren(['choice','timestamp']) && newData.child('choice').isNumber() && newData.child('timestamp').isNumber()"
            }
          },

          "firstCorrect": {
            ".validate": "newData.isString() || newData.val() == null"
          },

          "scored": {
            ".validate": "newData.isBoolean()"
          }
        }
      }
    },

    "rooms_bluff": {
      "$roomCode": {
        ".read": "auth != null",
        
        ".write": "(auth != null && !data.exists() && newData.child('hostId').val() == auth.uid) || (data.exists() && root.child('rooms_bluff/'+$roomCode+'/hostId').val() == auth.uid)",

        "hostId": {
          ".write": "!data.exists()",
          ".validate": "newData.isString()"
        },

        "createdAt": {
          ".validate": "newData.isNumber()"
        },

        "status": {
          ".validate": "newData.isString() && (newData.val() == 'lobby' || newData.val() == 'playing' || newData.val() == 'finished')"
        },

        "round": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
        },

        "maxRounds": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 20"
        },

        "cardsPerPlayer": {
          ".validate": "newData.isNumber() && newData.val() >= 3 && newData.val() <= 6"
        },

        "currentTurn": {
          ".validate": "newData.isString()"
        },

        "turnEndTime": {
          ".validate": "newData.isNumber()"
        },

        "declarationMode": {
          ".validate": "newData.isString() && (newData.val() == 'free' || newData.val() == 'assisted')"
        },

        "entryBet": {
          ".validate": "newData.isNumber() && newData.val() >= 10 && newData.val() <= 5000"
        },

        "players": {
          ".read": "auth != null",
          "$playerId": {
            ".write": "auth != null && (auth.uid == $playerId || root.child('rooms_bluff/'+$roomCode+'/hostId').val() == auth.uid)",
            ".validate": "newData.hasChildren(['name','alive']) && newData.child('name').isString() && newData.child('alive').isBoolean()"
          }
        },

        "hands": {
          "$playerId": {
            ".read": "auth != null && auth.uid == $playerId",
            ".write": "auth.token.admin == true",
            ".validate": "newData.val() != null"
          }
        },

        "wildcards": {
          "$playerId": {
            ".read": "auth != null && auth.uid == $playerId",
            ".write": "auth.token.admin == true",
            ".validate": "newData.isString() && newData.val().length >= 1 && newData.val().length <= 5"
          }
        },

        "currentDeclaration": {
          ".write": "auth != null && (root.child('rooms_bluff/'+$roomCode+'/hostId').val() == auth.uid || auth.token.admin == true)",
          ".validate": "newData.val() == null || (newData.hasChildren(['playerId','quantity','value']) && newData.child('playerId').isString() && newData.child('quantity').isNumber() && newData.child('quantity').val() >= 1 && newData.child('quantity').val() <= 30 && newData.child('value').isString())"
        },

        "actions": {
          "$playerId": {
            ".write": "auth != null && (auth.uid == $playerId || auth.token.admin == true)",
            ".validate": "newData.hasChildren(['type','timestamp']) && (newData.child('type').val() == 'declare' || newData.child('type').val() == 'challenge' || newData.child('type').val() == 'pass') && newData.child('timestamp').isNumber()"
          }
        },

        "timeline": {
          ".read": "auth != null",
          ".write": "auth.token.admin == true",
          ".validate": "newData.val() != null"
        },

        "challengeResult": {
          ".write": "auth.token.admin == true",
          ".validate": "newData.val() == null || (newData.hasChildren(['winner','loser','penalty']) && newData.child('winner').isString() && newData.child('loser').isString() && newData.child('penalty').isNumber())"
        },

        "gameCredits": {
          "$playerId": {
            ".read": "auth != null && auth.uid == $playerId",
            ".write": "auth.token.admin == true",
            ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100000"
          }
        },

        "payoutApplied": {
          "$playerId": {
            ".read": "auth != null && auth.uid == $playerId",
            ".write": "auth != null && auth.uid == $playerId && !data.exists()",
            ".validate": "newData.val() === true"
          }
        }
      }
    }
  }
}